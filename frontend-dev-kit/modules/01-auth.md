# Module 01: Authentication

## Screens

| Screen | Route | Mô t? |
|--------|-------|-------|
| Login | `/login` | ??ng nh?p |
| Register | `/register` | ??ng ký tài kho?n |
| Forgot Password | `/forgot-password` | Quên m?t kh?u |
| Reset Password | `/reset-password` | ??t l?i m?t kh?u |

---

## API Endpoints

### 1. Register
```http
POST /api/auth/register
```

**Request:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "confirmPassword": "SecurePass123!",
  "firstName": "John",
  "lastName": "Doe",
  "phoneNumber": "+84901234567"
}
```

**Response (200):**
```json
{
  "success": true,
  "message": "Registration successful",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "dGhpcyBpcyBhIHJlZnJlc2g...",
    "expiresIn": 3600,
    "user": {
      "id": "uuid",
      "email": "user@example.com",
      "firstName": "John",
      "lastName": "Doe",
      "role": "Guest",
      "avatarUrl": null
    }
  }
}
```

**Validation Rules:**
- `email`: Required, valid email format, unique
- `password`: Required, min 8 chars, 1 uppercase, 1 lowercase, 1 digit
- `confirmPassword`: Must match password
- `firstName`, `lastName`: Required, 2-100 chars

---

### 2. Login
```http
POST /api/auth/login
```

**Request:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!"
}
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIs...",
    "refreshToken": "dGhpcyBpcyBhIHJlZnJlc2g...",
    "expiresIn": 3600,
    "user": {
      "id": "uuid",
      "email": "user@example.com",
      "firstName": "John",
      "lastName": "Doe",
      "role": "Guest",
      "avatarUrl": "https://..."
    }
  }
}
```

**Error (401):**
```json
{
  "success": false,
  "message": "Invalid email or password"
}
```

---

### 3. Refresh Token
```http
POST /api/auth/refresh
```

**Request:**
```json
{
  "refreshToken": "dGhpcyBpcyBhIHJlZnJlc2g..."
}
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "accessToken": "new_access_token",
    "refreshToken": "new_refresh_token",
    "expiresIn": 3600
  }
}
```

---

### 4. Logout
```http
POST /api/auth/logout
Authorization: Bearer {accessToken}
```

**Response (200):**
```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

---

### 5. Get Current User
```http
GET /api/auth/me
Authorization: Bearer {accessToken}
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "email": "user@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "phoneNumber": "+84901234567",
    "avatarUrl": "https://...",
    "role": "Guest",
    "status": "Active",
    "createdAt": "2024-01-15T10:00:00Z"
  }
}
```

---

### 6. Change Password
```http
POST /api/auth/change-password
Authorization: Bearer {accessToken}
```

**Request:**
```json
{
  "currentPassword": "OldPass123!",
  "newPassword": "NewPass456!",
  "confirmNewPassword": "NewPass456!"
}
```

---

## Screen Specifications

### Login Screen
```
????????????????????????????????????????
?           ?? Hotel SAAS              ?
?                                      ?
?  ??????????????????????????????????  ?
?  ? Email                          ?  ?
?  ??????????????????????????????????  ?
?  ??????????????????????????????????  ?
?  ? Password                    ??  ?  ?
?  ??????????????????????????????????  ?
?                                      ?
?  ? Remember me     Forgot Password? ?
?                                      ?
?  ??????????????????????????????????  ?
?  ?          Sign In               ?  ?
?  ??????????????????????????????????  ?
?                                      ?
?  ???????????? or ????????????????   ?
?                                      ?
?  [G] Continue with Google            ?
?                                      ?
?  Don't have an account? Sign Up      ?
????????????????????????????????????????
```

### Register Screen
```
????????????????????????????????????????
?         Create Account               ?
?                                      ?
?  ????????????????? ??????????????????
?  ? First Name    ? ? Last Name     ??
?  ????????????????? ??????????????????
?  ??????????????????????????????????  ?
?  ? Email                          ?  ?
?  ??????????????????????????????????  ?
?  ??????????????????????????????????  ?
?  ? Phone Number (optional)        ?  ?
?  ??????????????????????????????????  ?
?  ??????????????????????????????????  ?
?  ? Password                    ??  ?  ?
?  ??????????????????????????????????  ?
?  ??????????????????????????????????  ?
?  ? Confirm Password            ??  ?  ?
?  ??????????????????????????????????  ?
?                                      ?
?  ? I agree to Terms & Privacy Policy?
?                                      ?
?  ??????????????????????????????????  ?
?  ?         Create Account         ?  ?
?  ??????????????????????????????????  ?
?                                      ?
?  Already have an account? Sign In    ?
????????????????????????????????????????
```

---

## TypeScript Types

```typescript
// Request Types
interface RegisterRequest {
  email: string;
  password: string;
  confirmPassword: string;
  firstName: string;
  lastName: string;
  phoneNumber?: string;
}

interface LoginRequest {
  email: string;
  password: string;
}

interface RefreshTokenRequest {
  refreshToken: string;
}

interface ChangePasswordRequest {
  currentPassword: string;
  newPassword: string;
  confirmNewPassword: string;
}

// Response Types
interface AuthResponse {
  accessToken: string;
  refreshToken: string;
  expiresIn: number;
  user: UserDto;
}

interface UserDto {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  phoneNumber?: string;
  avatarUrl?: string;
  role: UserRole;
  status: UserStatus;
  createdAt: string;
}

enum UserRole {
  SuperAdmin = 0,
  BrandAdmin = 1,
  HotelManager = 2,
  Staff = 3,
  Guest = 4
}

enum UserStatus {
  Active = 0,
  Inactive = 1,
  Suspended = 2
}
```

---

## Error Handling

| Error Code | Message | Action |
|------------|---------|--------|
| 400 | Validation failed | Show field errors |
| 401 | Invalid credentials | Show error message |
| 409 | Email already exists | Suggest login |
| 429 | Too many attempts | Show cooldown timer |
