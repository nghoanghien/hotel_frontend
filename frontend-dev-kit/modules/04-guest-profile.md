# Module 04: Guest Profile

## Screens

| Screen | Route | Mô t? |
|--------|-------|-------|
| Profile | `/profile` | Thông tin cá nhân |
| Edit Profile | `/profile/edit` | Ch?nh s?a thông tin |
| My Bookings | `/profile/bookings` | Danh sách ??t phòng |
| Wishlist | `/profile/wishlist` | Danh sách yêu thích |
| Recently Viewed | `/profile/recently-viewed` | ?ã xem g?n ?ây |

---

## API Endpoints

### 1. Get Profile
```http
GET /api/guest-profile
Authorization: Bearer {token}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "email": "john@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "phoneNumber": "+84901234567",
    "avatarUrl": "https://...",
    "dateOfBirth": "1990-05-15",
    "nationality": "Vietnam",
    "address": "123 Main St",
    "city": "Ho Chi Minh City",
    "country": "Vietnam",
    "postalCode": "700000",
    "idDocumentType": "Passport",
    "idDocumentNumber": "C12345678",
    "preferredLanguage": "en",
    "preferredCurrency": "VND",
    "emailNotificationsEnabled": true,
    "smsNotificationsEnabled": false,
    "statistics": {
      "totalBookings": 12,
      "totalSpent": 86250000,
      "reviewsWritten": 5,
      "memberSince": "2023-01-15"
    }
  }
}
```

---

### 2. Update Profile
```http
PUT /api/guest-profile
Authorization: Bearer {token}
```

**Request:**
```json
{
  "firstName": "John",
  "lastName": "Doe",
  "phoneNumber": "+84901234567",
  "dateOfBirth": "1990-05-15",
  "nationality": "Vietnam",
  "address": "123 Main St",
  "city": "Ho Chi Minh City",
  "country": "Vietnam",
  "postalCode": "700000",
  "preferredLanguage": "vi",
  "preferredCurrency": "VND"
}
```

---

### 3. Upload Avatar
```http
POST /api/guest-profile/avatar
Authorization: Bearer {token}
Content-Type: multipart/form-data

file: [image file]
```

**Response:**
```json
{
  "success": true,
  "data": {
    "avatarUrl": "https://i.ibb.co/..."
  }
}
```

---

### 4. Update ID Document
```http
PUT /api/guest-profile/id-document
Authorization: Bearer {token}
```

**Request:**
```json
{
  "idDocumentType": "Passport",
  "idDocumentNumber": "C12345678"
}
```

---

### 5. Update Notification Settings
```http
PUT /api/guest-profile/notifications
Authorization: Bearer {token}
```

**Request:**
```json
{
  "emailNotificationsEnabled": true,
  "smsNotificationsEnabled": false
}
```

---

### 6. Get Wishlist
```http
GET /api/wishlist
Authorization: Bearer {token}
```

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "hotelId": "uuid",
      "hotel": {
        "id": "uuid",
        "name": "Marriott Saigon",
        "imageUrl": "https://...",
        "city": "Ho Chi Minh City",
        "starRating": 5,
        "averageRating": 4.5,
        "startingPrice": 3750000
      },
      "note": "For anniversary trip",
      "addedAt": "2024-01-10T10:00:00Z"
    }
  ]
}
```

---

### 7. Add to Wishlist
```http
POST /api/wishlist
Authorization: Bearer {token}
```

**Request:**
```json
{
  "hotelId": "uuid",
  "note": "For anniversary trip"
}
```

---

### 8. Remove from Wishlist
```http
DELETE /api/wishlist/{id}
Authorization: Bearer {token}
```

---

### 9. Get Recently Viewed
```http
GET /api/guest-profile/recently-viewed
Authorization: Bearer {token}
```

**Query Parameters:**
| Param | Type | Default |
|-------|------|---------|
| `limit` | int | 10 |

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "hotel": {
        "id": "uuid",
        "name": "Marriott Saigon",
        "imageUrl": "https://...",
        "city": "Ho Chi Minh City",
        "starRating": 5,
        "startingPrice": 3750000
      },
      "viewedAt": "2024-01-15T10:00:00Z",
      "viewCount": 3
    }
  ]
}
```

---

### 10. Track Recently Viewed
```http
POST /api/guest-profile/recently-viewed/{hotelId}
Authorization: Bearer {token}
```

---

### 11. Get My Reviews
```http
GET /api/guest-profile/reviews
Authorization: Bearer {token}
```

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "hotelId": "uuid",
      "hotelName": "Marriott Saigon",
      "rating": 5,
      "title": "Amazing stay!",
      "comment": "The room was spotless...",
      "status": "Published",
      "createdAt": "2024-01-15T10:00:00Z"
    }
  ]
}
```

---

## Screen Specifications

### Profile Screen
```
????????????????????????????????????????????????????
?  ? Back                Profile                   ?
????????????????????????????????????????????????????
?           ???????                               ?
?           ? ??  ?  ??                           ?
?           ???????                               ?
?          John Doe                               ?
?       john@example.com                          ?
?       Member since Jan 2023                     ?
?                                                  ?
?  ???????????? ???????????? ????????????        ?
?  ?    12    ? ?86.250.000? ?    5     ?        ?
?  ? Bookings ? ?Spent(VND)? ? Reviews  ?        ?
?  ???????????? ???????????? ????????????        ?
????????????????????????????????????????????????????
?  ?? My Bookings                              ?  ?
????????????????????????????????????????????????????
?  ?? Wishlist                                 ?  ?
????????????????????????????????????????????????????
?  ?? Recently Viewed                          ?  ?
????????????????????????????????????????????????????
?  ? My Reviews                               ?  ?
????????????????????????????????????????????????????
?  ?? Personal Information                     ?  ?
????????????????????????????????????????????????????
?  ?? Notification Settings                    ?  ?
????????????????????????????????????????????????????
?  ?? Change Password                          ?  ?
????????????????????????????????????????????????????
?                                                  ?
?  ?????????????????????????????????????????????? ?
?  ?              Sign Out                      ? ?
?  ?????????????????????????????????????????????? ?
????????????????????????????????????????????????????
```

### My Bookings Screen
```
????????????????????????????????????????????????????
?  ? Back            My Bookings                   ?
????????????????????????????????????????????????????
?  [Upcoming] [Completed] [Cancelled]              ?
????????????????????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? ??? ? Marriott Saigon                      ? ?
?  ?    ? BK-20240201-ABC123                   ? ?
?  ?    ? Feb 1 - Feb 3, 2024                  ? ?
?  ?    ? Deluxe King • 2 guests               ? ?
?  ?    ? ?????????????????????????????????    ? ?
?  ?    ? Total: 6.850.000 VND    [Details]    ? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ??? ? Hilton Opera                         ? ?
?  ?    ? BK-20240315-XYZ789                   ? ?
?  ?    ? Mar 15 - Mar 18, 2024                ? ?
?  ?    ? Suite • 2 guests                     ? ?
?  ?    ? ?????????????????????????????????    ? ?
?  ?    ? Total: 11.250.000 VND   [Details]    ? ?
?  ?????????????????????????????????????????????? ?
????????????????????????????????????????????????????
```

### Wishlist Screen
```
????????????????????????????????????????????????????
?  ? Back             Wishlist                     ?
????????????????????????????????????????????????????
?  3 hotels saved                                  ?
????????????????????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? ???                                    ??  ? ?
?  ? Marriott Saigon              ?????    ? ?
?  ? Ho Chi Minh City                          ? ?
?  ? From 3.750.000 VND/night     ? 4.5 (234)  ? ?
?  ? ?? For anniversary trip                   ? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ???                                    ??  ? ?
?  ? InterContinental Danang      ?????    ? ?
?  ? Da Nang                                   ? ?
?  ? From 5.000.000 VND/night     ? 4.8 (456)  ? ?
?  ?????????????????????????????????????????????? ?
????????????????????????????????????????????????????
```

---

## TypeScript Types

```typescript
interface GuestProfileDto {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  phoneNumber?: string;
  avatarUrl?: string;
  dateOfBirth?: string;
  nationality?: string;
  address?: string;
  city?: string;
  country?: string;
  postalCode?: string;
  idDocumentType?: string;
  idDocumentNumber?: string;
  preferredLanguage?: string;
  preferredCurrency?: string;
  emailNotificationsEnabled: boolean;
  smsNotificationsEnabled: boolean;
  statistics: GuestStatistics;
}

interface GuestStatistics {
  totalBookings: number;
  totalSpent: number;
  reviewsWritten: number;
  memberSince: string;
}

interface UpdateProfileRequest {
  firstName?: string;
  lastName?: string;
  phoneNumber?: string;
  dateOfBirth?: string;
  nationality?: string;
  address?: string;
  city?: string;
  country?: string;
  postalCode?: string;
  preferredLanguage?: string;
  preferredCurrency?: string;
}

interface WishlistItemDto {
  id: string;
  hotelId: string;
  hotel: HotelSummaryDto;
  note?: string;
  addedAt: string;
}

interface RecentlyViewedDto {
  id: string;
  hotel: HotelSummaryDto;
  viewedAt: string;
  viewCount: number;
}
