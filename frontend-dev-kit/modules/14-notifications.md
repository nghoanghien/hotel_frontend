# Module 14: Notifications

## Screens

| Screen | Route | Mô t? |
|--------|-------|-------|
| Notifications List | `/notifications` | Danh sách thông báo |
| Notification Bell | Component | Bell icon v?i badge |

---

## Access Control

| Role | Permissions |
|------|-------------|
| All authenticated users | View & manage own notifications |

---

## API Endpoints

### 1. Get User Notifications
```http
GET /api/notifications
Authorization: Bearer {token}
```

**Query Parameters:**
| Param | Type | Default | Description |
|-------|------|---------|-------------|
| `limit` | int | 50 | Maximum notifications to return |

**Response:**
```json
{
  "success": true,
  "data": {
    "totalCount": 45,
    "unreadCount": 12,
    "notifications": [
      {
        "id": "uuid",
        "type": "BookingConfirmation",
        "channel": "InApp",
        "status": "Sent",
        "title": "??t phòng thành công!",
        "message": "??t phòng t?i Marriott Times Square ?ã ???c xác nh?n. Mã #BK123456789",
        "actionUrl": "/bookings/uuid",
        "bookingId": "uuid",
        "promotionId": null,
        "readAt": null,
        "isRead": false,
        "createdAt": "2024-01-20T10:30:00Z",
        "updatedAt": "2024-01-20T10:30:00Z"
      }
    ]
  }
}
```

---

### 2. Get Unread Count
```http
GET /api/notifications/unread-count
Authorization: Bearer {token}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "count": 12
  }
}
```

---

### 3. Mark Notification as Read
```http
POST /api/notifications/{id}/read
Authorization: Bearer {token}
```

**Response:**
```json
{
  "success": true,
  "message": "Marked as read",
  "data": true
}
```

---

### 4. Mark All Notifications as Read
```http
POST /api/notifications/read-all
Authorization: Bearer {token}
```

---

### 5. Mark Multiple Notifications as Read
```http
POST /api/notifications/read-multiple
Authorization: Bearer {token}
```

**Request:**
```json
{
  "notificationIds": ["uuid-1", "uuid-2", "uuid-3"]
}
```

---

### 6. Delete Notification
```http
DELETE /api/notifications/{id}
Authorization: Bearer {token}
```

---

## Screen Specifications

### Notification Bell Component
```
???????????????????????????????????????????
?                                    ??   ?
?                                   (12)  ?  ? Badge with unread count
???????????????????????????????????????????

On Click ? Dropdown:
???????????????????????????????????????????
?  Thông báo              [??c t?t c?]    ?
???????????????????????????????????????????
?  ????????????????????????????????????? ?
?  ? ?? ??t phòng thành công!          ? ?
?  ?     ??t phòng t?i Marriott...     ? ?
?  ?     2 gi? tr??c                   ? ?
?  ????????????????????????????????????? ?
?  ????????????????????????????????????? ?
?  ? ?? ?? Flash Sale: Gi?m 30%!       ? ?
?  ?     ?u ?ãi có h?n! Gi?m 30%...    ? ?
?  ?     Hôm qua                       ? ?
?  ????????????????????????????????????? ?
???????????????????????????????????????????
?         [Xem t?t c? thông báo]          ?
???????????????????????????????????????????
```

### Notifications Page
```
????????????????????????????????????????????????????
?  ?? Thông báo                                    ?
????????????????????????????????????????????????????
?  [T?t c?] [Ch?a ??c (12)] [Booking] [Khuy?n mãi] ?
?                                   [??c t?t c?]   ?
????????????????????????????????????????????????????
?  ??? Hôm nay ????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? ?? ? ??t phòng thành công!                 ? ?
?  ?    ??t phòng t?i Marriott Times Square     ? ?
?  ?    ?ã ???c xác nh?n.                       ? ?
?  ?    Mã xác nh?n #BK123456789                ? ?
?  ?                                            ? ?
?  ?    2 gi? tr??c       [Xem booking] [×]     ? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ?? ?? Thanh toán thành công                 ? ?
?  ?    ?ã nh?n thanh toán 15,000,000 VND       ? ?
?  ?    cho booking #BK123456789.               ? ?
?  ?                                            ? ?
?  ?    3 gi? tr??c       [Xem hóa ??n] [×]     ? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  ??? Hôm qua ????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ? ?? Flash Sale: Gi?m 30%!                 ? ?
?  ?    ?u ?ãi có h?n! Gi?m 30% cho t?t c?      ? ?
?  ?    ??t phòng cu?i tu?n. Mã: FLASH30        ? ?
?  ?                                            ? ?
?  ?    Hôm qua            [Xem ?u ?ãi] [×]     ? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  [T?i thêm]                                     ?
????????????????????????????????????????????????????
```

---

## Notification Types & Icons

| Type | Icon | Mô t? |
|------|------|-------|
| `BookingConfirmation` | ? | Xác nh?n ??t phòng |
| `BookingCancellation` | ? | H?y ??t phòng |
| `BookingReminder` | ?? | Nh?c nh? ??t phòng |
| `CheckInReminder` | ?? | Nh?c check-in |
| `CheckOutReminder` | ?? | Nh?c check-out |
| `PaymentReceived` | ?? | Thanh toán thành công |
| `PaymentFailed` | ?? | Thanh toán th?t b?i |
| `ReviewRequest` | ?? | Yêu c?u ?ánh giá |
| `PromotionAlert` | ?? | Thông báo khuy?n mãi |
| `SystemAlert` | ?? | Thông báo h? th?ng |

---

## User Flow

### Viewing Notifications
```
1. User clicks bell icon (header)
2. Dropdown shows latest notifications v?i unread badge
3. Click notification ? Navigate to actionUrl & mark as read
4. Click "View All" ? Navigate to /notifications page
```

### Managing Notifications
```
1. User on /notifications page
2. Filter by type (All, Unread, Bookings, Promotions)
3. Click notification ? Navigate & mark read
4. Click X ? Delete notification
5. Click "Mark all read" ? Mark all as read
```

---

## Integration Notes

### Polling Strategy
- Unread count: Poll every 10-30 seconds
- Notification list: Poll every 30-60 seconds
- Stop polling when tab inactive

### Future: Real-time (WebSocket/SignalR)
Backend ch?a h? tr?. Khi có:
- Connect to `/notificationHub`
- Listen event `ReceiveNotification`
- Update UI real-time

### Action URL Routing
- `/bookings/{id}` ? Booking detail
- `/promotions/{code}` ? Promotion detail
- `/reviews/new?bookingId={id}` ? Write review

---

## TypeScript Types

```typescript
interface NotificationDto {
  id: string;
  type: NotificationType;
  channel: NotificationChannel;
  status: NotificationStatus;
  title: string;
  message: string;
  actionUrl?: string;
  bookingId?: string;
  promotionId?: string;
  readAt?: string;
  isRead: boolean;
  createdAt: string;
  updatedAt: string;
}

interface NotificationListDto {
  totalCount: number;
  unreadCount: number;
  notifications: NotificationDto[];
}

enum NotificationType {
  BookingConfirmation = 0,
  BookingCancellation = 1,
  BookingReminder = 2,
  CheckInReminder = 3,
  CheckOutReminder = 4,
  PaymentReceived = 5,
  PaymentFailed = 6,
  ReviewRequest = 7,
  PromotionAlert = 8,
  SystemAlert = 9
}

enum NotificationChannel {
  InApp = 0,
  Email = 1,
  SMS = 2,
  Push = 3
}

enum NotificationStatus {
  Pending = 0,
  Sent = 1,
  Read = 2,
  Failed = 3
}
