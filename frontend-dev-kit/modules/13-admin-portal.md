# Module 13: Super Admin Portal

## Authorization & Permissions

> **Hệ thống phân quyền động**: Sử dụng `[Authorize(Policy = "Permission:xxx")]` thay vì role-based cứng

### SuperAdmin Permission Scope

SuperAdmin có quyền **system-wide** nhưng **KHÔNG được phép CRUD hotels trực tiếp**. Chỉ BrandAdmin mới có quyền quản lý hotels.

### Permission Policies cho Admin

| Policy | Mô tả | Cho phép |
|--------|-------|----------|
| `Permission:brands.read` | Xem brands | SuperAdmin, BrandAdmin (own) |
| `Permission:brands.create` | Tạo brand mới | SuperAdmin |
| `Permission:brands.update` | Cập nhật brand | SuperAdmin |
| `Permission:brands.delete` | Xóa brand | SuperAdmin |
| `Permission:users.read` | Xem users | SuperAdmin, BrandAdmin, HotelManager |
| `Permission:users.create` | Tạo user | SuperAdmin, BrandAdmin, HotelManager |
| `Permission:users.update` | Cập nhật user | SuperAdmin, BrandAdmin (brand), HotelManager (hotel) |
| `Permission:users.delete` | Xóa user | SuperAdmin, BrandAdmin, HotelManager |
| `Permission:dashboard.viewall` | Xem dashboard toàn hệ thống | SuperAdmin |
| `Permission:dashboard.view` | Xem dashboard | Tất cả authenticated users |
| `Permission:subscriptions.read` | Xem subscriptions | SuperAdmin, BrandAdmin |
| `Permission:subscriptions.update` | Cập nhật subscriptions | SuperAdmin |

### Role-Based Access Matrix cho Admin Portal

| Action | SuperAdmin | BrandAdmin | HotelManager | Receptionist | Staff |
|--------|------------|------------|--------------|--------------|-------|
| Xem tất cả brands | ✅ | Own only | ❌ | ❌ | ❌ |
| Tạo brand | ✅ | ❌ | ❌ | ❌ | ❌ |
| Xóa brand | ✅ | ❌ | ❌ | ❌ | ❌ |
| Xem tất cả users | ✅ | Brand users | Hotel users | ❌ | ❌ |
| Tạo user (BrandAdmin) | ✅ | ✅ (trong brand) | ❌ | ❌ | ❌ |
| Tạo user (HotelManager) | ✅ | ❌ | ✅ (trong hotel) | ❌ | ❌ |
| Xóa user | ✅ | Brand users | Hotel users | ❌ | ❌ |
| Xem system dashboard | ✅ | ❌ | ❌ | ❌ | ❌ |
| Xem brand dashboard | ✅ | ✅ (own) | ❌ | ❌ | ❌ |
| Duyệt onboarding | ✅ | ❌ | ❌ | ❌ | ❌ |
| Quản lý subscriptions | ✅ | Read only | ❌ | ❌ | ❌ |

### Lưu ý quan trọng

- **SuperAdmin KHÔNG thể**: Create/Update/Delete hotels trực tiếp
- **SuperAdmin CHỉ có thể**: Xem hotels (read-only) để monitor
- **Hotel CRUD**: Chỉ BrandAdmin mới có quyền này cho hotels trong brand của mình

---

## Screens

| Screen | Route | M� t? |
|--------|-------|-------|
| Admin Dashboard | `/admin/dashboard` | T?ng quan h? th?ng |
| Onboarding Review | `/admin/onboarding` | Duy?t partner m?i |
| User Management | `/admin/users` | Qu?n l� users |
| Brand Management | `/admin/brands` | Qu?n l� brands |
| System Settings | `/admin/settings` | C�i ??t h? th?ng |

---

## Access Control

> ?? All endpoints require `SuperAdmin` role unless otherwise specified

---

## API Endpoints

### 1. Admin Dashboard Stats (Brand Dashboard)
```http
GET /api/dashboard/brand/{brandId}
Authorization: Bearer {token}
Roles: SuperAdmin, BrandAdmin
```
**Required Policy:** `Permission:dashboard.viewall` (SuperAdmin) hoặc `Permission:dashboard.view` (BrandAdmin)

**Response:**
```json
{
  "success": true,
  "data": {
    "revenue": {
      "todayRevenue": 125000000,
      "weekRevenue": 875000000,
      "monthRevenue": 3125000000,
      "yearRevenue": 37500000000,
      "revenueGrowth": 15.5,
      "currency": "VND"
    },
    "bookings": {
      "totalBookings": 45000,
      "pendingBookings": 120,
      "confirmedBookings": 350,
      "checkedInBookings": 89,
      "cancelledBookings": 45,
      "todayCheckIns": 25,
      "todayCheckOuts": 30,
      "bookingGrowth": 8.2
    },
    "occupancy": {
      "totalRooms": 5400,
      "occupiedRooms": 3240,
      "availableRooms": 2100,
      "maintenanceRooms": 60,
      "occupancyRate": 60.00,
      "averageDailyRate": 7125000,
      "revPAR": 4275000
    },
    "reviews": {
      "totalReviews": 12500,
      "pendingReviews": 45,
      "averageRating": 4.3,
      "fiveStarCount": 7500,
      "fourStarCount": 3500,
      "threeStarCount": 1000,
      "twoStarCount": 350,
      "oneStarCount": 150
    },
    "topRooms": [...],
    "recentActivities": [...]
  }
}
```

---

### 2. Get Onboarding Applications (Admin)
```http
GET /api/onboarding/admin/all
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.create` (SuperAdmin)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "brandName": "Sunset Hotels",
      "hotelName": "Sunset Beach Resort",
      "contactName": "Nguyen Van A",
      "contactEmail": "contact@sunsethotels.com",
      "status": "PendingReview",
      "selectedPlanId": "uuid",
      "documentsCount": 3,
      "submittedAt": "2024-01-15T10:00:00Z",
      "city": "Da Nang",
      "country": "Vietnam",
      "starRating": 5,
      "totalRooms": 120
    }
  ]
}
```

---

### 3. Get Pending Onboarding Applications
```http
GET /api/onboarding/admin/pending
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.create` (SuperAdmin)

---

### 4. Search Onboarding Applications
```http
GET /api/onboarding/admin/search
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.create` (SuperAdmin)

**Query Parameters:**
| Param | Type | Default | Description |
|-------|------|---------|-------------|
| `query` | string | - | Search by brand/hotel name |
| `status` | OnboardingStatus | - | Filter by status |
| `country` | string | - | Filter by country |
| `city` | string | - | Filter by city |
| `page` | int | 1 | Page number |
| `pageSize` | int | 20 | Items per page |
| `sortBy` | string | - | Sort field |
| `sortDescending` | bool | true | Sort direction |

**OnboardingStatus Enum:**
```typescript
enum OnboardingStatus {
  Draft = 0,
  PendingReview = 1,
  UnderReview = 2,
  RequiresChanges = 3,
  Approved = 4,
  Rejected = 5
}
```

---

### 5. Get Onboarding Statistics
```http
GET /api/onboarding/admin/stats
Authorization: Bearer {token}
```
**Required Policy:** `Permission:dashboard.viewall` (SuperAdmin)

**Response:**
```json
{
  "success": true,
  "data": {
    "totalApplications": 150,
    "draft": 20,
    "pendingReview": 8,
    "underReview": 12,
    "requiresChanges": 5,
    "approved": 100,
    "rejected": 5,
    "thisMonthApplications": 15,
    "thisMonthApproved": 10,
    "averageProcessingDays": 3.5
  }
}
```

---

### 6. Review Onboarding Application
```http
POST /api/onboarding/admin/{id}/review
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.create` (SuperAdmin)

**Request:**
```json
{
  "newStatus": "UnderReview",
  "notes": "Starting review process",
  "requiredDocuments": ["TaxCertificate"]
}
```

**NewStatus Options:**
- `UnderReview` - Move to under review
- `RequiresChanges` - Request additional documents
- `Rejected` - Reject application

---

### 7. Approve Onboarding Application
```http
POST /api/onboarding/admin/{id}/approve
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.create` (SuperAdmin) - Tạo Brand + Hotel + Subscription

**Response:**
```json
{
  "success": true,
  "message": "Application approved! Brand, Hotel, and Subscription have been created.",
  "data": {
    "id": "uuid",
    "status": "Approved",
    "createdBrandId": "uuid",
    "createdHotelId": "uuid",
    "createdSubscriptionId": "uuid"
  }
}
```

---

### 8. Review Document
```http
POST /api/onboarding/admin/documents/{documentId}/review
Authorization: Bearer {token}
Roles: SuperAdmin
```

**Request:**
```json
{
  "status": "Approved",
  "notes": "Document verified successfully"
}
```

**Document Status Options:**
- `Approved`
- `Rejected`

---

### 9. Get All Users
```http
GET /api/users
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.read` (scope-based)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "email": "john@example.com",
      "firstName": "John",
      "lastName": "Doe",
      "phoneNumber": "+84-123-456-789",
      "avatarUrl": "https://...",
      "role": "BrandAdmin",
      "status": "Active",
      "nationality": "Vietnam",
      "brandId": "uuid",
      "hotelId": null,
      "lastLoginAt": "2024-01-20T10:00:00Z",
      "createdAt": "2023-06-15T10:00:00Z"
    }
  ]
}
```

---

### 10. Get Users by Role
```http
GET /api/users/role/{role}
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.read` (scope-based)

**Role Options:**
```typescript
enum UserRole {
  SuperAdmin = 0,
  BrandAdmin = 1,
  HotelManager = 2,
  Receptionist = 3,
  Guest = 4
}
```

---

### 11. Update User
```http
PUT /api/users/{id}
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.update` (scope-based)

**Request:**
```json
{
  "firstName": "John",
  "lastName": "Doe",
  "phoneNumber": "+84-123-456-789",
  "role": "HotelManager",
  "status": "Suspended",
  "brandId": "uuid",
  "hotelId": "uuid"
}
```

**UserStatus Options:**
```typescript
enum UserStatus {
  Active = 0,
  Inactive = 1,
  Suspended = 2,
  PendingVerification = 3
}
```

---

### 12. Delete User
```http
DELETE /api/users/{id}
Authorization: Bearer {token}
```
**Required Policy:** `Permission:users.delete` (scope-based)

---

### 13. Get All Brands
```http
GET /api/brands
Authorization: Bearer {token}
```
**Required Policy:** `Permission:brands.read`

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "Sunset Hotels",
      "description": "Luxury beachfront hotels",
      "logoUrl": "https://...",
      "website": "https://sunsethotels.com",
      "email": "contact@sunsethotels.com",
      "phoneNumber": "+84-28-1234-5678",
      "address": "123 Beach Road",
      "city": "Da Nang",
      "country": "Vietnam",
      "isActive": true,
      "commissionRate": "15",
      "createdAt": "2023-06-15T10:00:00Z"
    }
  ]
}
```

---

### 14. Get Brand by ID
```http
GET /api/brands/{id}
Authorization: Bearer {token}
```

---

### 15. Create Brand
```http
POST /api/brands
Authorization: Bearer {token}
```
**Required Policy:** `Permission:brands.create` (SuperAdmin only)

**Request:**
```json
{
  "name": "Sunset Hotels",
  "description": "Luxury beachfront hotels",
  "logoUrl": "https://...",
  "website": "https://sunsethotels.com",
  "email": "contact@sunsethotels.com",
  "phoneNumber": "+84-28-1234-5678",
  "address": "123 Beach Road",
  "city": "Da Nang",
  "country": "Vietnam"
}
```

---

### 16. Update Brand
```http
PUT /api/brands/{id}
Authorization: Bearer {token}
```
**Required Policy:** `Permission:brands.update` (SuperAdmin only)

---

### 17. Delete Brand
```http
DELETE /api/brands/{id}
Authorization: Bearer {token}
```
**Required Policy:** `Permission:brands.delete` (SuperAdmin only)

---

## Screen Specifications

### Admin Dashboard Screen
```
????????????????????????????????????????????????????????????????????????
?  ??? Admin Dashboard                                                  ?
????????????????????????????????????????????????????????????????????????
?                                                                      ?
?  ??? Platform Overview ???????????????????????????????????????????? ?
?  ?????????? ?????????? ?????????? ?????????? ?????????? ?????????? ?
?  ?   45   ? ?   120  ? ?  5,400 ? ?   850  ? ? 12,500 ? ? 45,000 ? ?
?  ? Brands ? ? Hotels ? ? Rooms  ? ? Staff  ? ? Guests ? ?Bookings? ?
?  ?????????? ?????????? ?????????? ?????????? ?????????? ?????????? ?
?                                                                      ?
?  ??? Revenue ?????????????????????????????????????????????????????? ?
?  ??????????????????????? ??????????????????? ???????????????????   ?
?  ?   3.125.000.000     ? ?  2.375.000.000  ? ?    750.000.000  ?   ?
?  ?  Platform Revenue   ? ?   Commission    ? ?  Subscriptions  ?   ?
?  ?       (VND)         ? ?     (VND)       ? ?     (VND)       ?   ?
?  ??????????????????????? ??????????????????? ???????????????????   ?
?                                                                      ?
?  ??? Pending Actions ????????????????????????????????????????????? ?
?  ??????????????????????? ??????????????????? ???????????????????   ?
?  ?   ? 8 Pending      ? ?  ? 45 Pending  ? ?  ?? 12 Open     ?   ?
?  ?   Onboarding        ? ?  Review Moderation?  Support Tickets ?   ?
?  ?   [Review ?]        ? ?   [Review ?]    ? ?   [View ?]      ?   ?
?  ??????????????????????? ??????????????????? ????????????????????????
?                                                                      ?
?  ??? Quick Actions ??????????????????????????????????????????????? ?
?  [?? Users] [?? Brands] [?? Hotels] [?? Reports] [?? Settings]      ?
?                                                                      ?
????????????????????????????????????????????????????????????????????????
```

### Onboarding Review Screen
```
????????????????????????????????????????????????????
?  ? Back    Onboarding Applications               ?
????????????????????????????????????????????????????
?  [All] [Pending 5] [Under Review 8] [Changes 3]  ?
?  ?? Search applications...                       ?
?  Country: [All ?]  City: [All ?]                 ?
????????????????????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? Sunset Beach Resort           ? PendingReview?
?  ? Brand: Sunset Hotels                       ? ?
?  ? Contact: Nguyen Van A                      ? ?
?  ?         contact@sunsethotels.com           ? ?
?  ? ?????????????????????????????????????      ? ?
?  ? Location: Da Nang, Vietnam                 ? ?
?  ? Rooms: 120 � ?????                      ? ?
?  ? Submitted: Jan 15, 2024                    ? ?
?  ? ?????????????????????????????????????      ? ?
?  ? Documents: 3 uploaded                      ? ?
?  ? [Review Application]                       ? ?
?  ?????????????????????????????????????????????? ?
????????????????????????????????????????????????????
```

### Review Application Detail
```
????????????????????????????????????????????????????
?  ? Back    Sunset Beach Resort        [Actions ?]?
????????????????????????????????????????????????????
?  Status: ? Under Review                          ?
?  Submitted: Jan 15, 2024                         ?
?                                                  ?
?  ??? Brand Information ????????????????????????  ?
?  Name: Sunset Hotels                             ?
?  Description: Luxury beachfront hotels           ?
?  Website: https://sunsethotels.com               ?
?                                                  ?
?  ??? Hotel Information ????????????????????????  ?
?  Name: Sunset Beach Resort                       ?
?  Star Rating: ?????                          ?
?  Total Rooms: 120                                ?
?  Address: 123 Beach Road, Da Nang, Vietnam       ?
?                                                  ?
?  ??? Contact Person ???????????????????????????  ?
?  Name: Nguyen Van A (General Manager)            ?
?  Email: contact@sunsethotels.com                 ?
?  Phone: +84-236-1234-567                         ?
?                                                  ?
?  ??? Legal Information ????????????????????????  ?
?  Business Name: Sunset Hotels Vietnam Co., Ltd   ?
?  Tax ID: 0123456789                              ?
?  Registration: BRN-2024-001                      ?
?                                                  ?
?  ??? Selected Plan ????????????????????????????  ?
?  Plan: Premium (4,975,000 VND/mo)                 ?
?  Billing: Yearly (20% discount)                  ?
?                                                  ?
?  ??? Documents ????????????????????????????????  ?
?  ?????????????????????????????????????????????? ?
?  ? ?? Business License          ? Pending    ? ?
?  ?    business_license.pdf                    ? ?
?  ?    [View] [? Approve] [? Reject]         ? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ?? Tax Certificate           ? Approved   ? ?
?  ?    tax_cert.pdf                            ? ?
?  ?    [View]                                  ? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  ??? Admin Notes ??????????????????????????????  ?
?  ?????????????????????????????????????????????? ?
?  ? Add internal notes...                      ? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  ???????????????? ?????????????? ?????????????? ?
?  ? ? Approve   ? ? ?? Request ? ? ? Reject  ? ?
?  ?              ? ?  Changes   ? ?            ? ?
?  ???????????????? ?????????????? ?????????????? ?
????????????????????????????????????????????????????
```

### User Management Screen
```
????????????????????????????????????????????????????
?  ?? User Management                  [+ Add User]?
????????????????????????????????????????????????????
?  ?? Search users...                              ?
?  Role: [All ?]  Status: [All ?]                  ?
????????????????????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? ?? John Doe                    ? Active    ? ?
?  ?    john@example.com                        ? ?
?  ?    Role: BrandAdmin � Sunset Hotels        ? ?
?  ?    Last login: 2 hours ago                 ? ?
?  ?                         [Edit] [Suspend]   ? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ?? Jane Smith                  ? Active    ? ?
?  ?    jane@example.com                        ? ?
?  ?    Role: HotelManager � Marriott Saigon    ? ?
?  ?    Last login: 1 day ago                   ? ?
?  ?                         [Edit] [Suspend]   ? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ?? Bob Wilson                  ? Suspended ? ?
?  ?    bob@example.com                         ? ?
?  ?    Role: Receptionist � Hilton Danang      ? ?
?  ?    Reason: Terms violation                 ? ?
?  ?                        [Edit] [Reactivate] ? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  ??? Pagination ???????????????????????????????  ?
?  [? Previous] Page 1 of 10 [Next ?]             ?
????????????????????????????????????????????????????
```

### Brand Management Screen
```
????????????????????????????????????????????????????
?  ?? Brand Management                [+ Add Brand]?
????????????????????????????????????????????????????
?  ?? Search brands...                             ?
?  Status: [All ?]                                 ?
????????????????????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? ?? Marriott Hotels & Resorts   ? Active    ? ?
?  ?    3 Hotels � 450 Rooms                    ? ?
?  ?    Commission: 15%                         ? ?
?  ?    Subscription: Premium (Active)          ? ?
?  ?    Created: Jun 15, 2023                   ? ?
?  ?                   [View] [Edit] [Deactivate]? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ?? Hilton Worldwide            ? Active    ? ?
?  ?    2 Hotels � 300 Rooms                    ? ?
?  ?    Commission: 15%                         ? ?
?  ?    Subscription: Standard (Active)         ? ?
?  ?    Created: Jul 20, 2023                   ? ?
?  ?                   [View] [Edit] [Deactivate]? ?
?  ?????????????????????????????????????????????? ?
????????????????????????????????????????????????????
```

---

## TypeScript Types

```typescript
// Onboarding Types
interface OnboardingSummaryDto {
  id: string;
  brandName: string;
  hotelName: string;
  contactName: string;
  contactEmail: string;
  contactPhone: string;
  status: OnboardingStatus;
  selectedPlanId?: string;
  city: string;
  country: string;
  starRating: number;
  totalRooms: number;
  documentsCount: number;
  submittedAt?: string;
  createdAt: string;
}

enum OnboardingStatus {
  Draft = 0,
  PendingReview = 1,
  UnderReview = 2,
  RequiresChanges = 3,
  Approved = 4,
  Rejected = 5
}

interface OnboardingStatsDto {
  totalApplications: number;
  draft: number;
  pendingReview: number;
  underReview: number;
  requiresChanges: number;
  approved: number;
  rejected: number;
  thisMonthApplications: number;
  thisMonthApproved: number;
  averageProcessingDays: number;
}

interface ReviewOnboardingDto {
  newStatus: OnboardingStatus;
  notes?: string;
  requiredDocuments?: string[];
}

interface ReviewDocumentDto {
  status: DocumentStatus;
  notes?: string;
}

enum DocumentStatus {
  Pending = 0,
  Approved = 1,
  Rejected = 2
}

enum DocumentType {
  BusinessLicense = 0,
  TaxCertificate = 1,
  OwnershipProof = 2,
  HotelPhotos = 3,
  ManagerId = 4,
  Other = 5
}

// User Types
interface UserDto {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  phoneNumber?: string;
  avatarUrl?: string;
  role: UserRole;
  status: UserStatus;
  nationality?: string;
  brandId?: string;
  hotelId?: string;
  lastLoginAt?: string;
  createdAt: string;
  updatedAt: string;
}

interface UpdateUserDto {
  firstName?: string;
  lastName?: string;
  phoneNumber?: string;
  role?: UserRole;
  status?: UserStatus;
  brandId?: string;
  hotelId?: string;
}

enum UserRole {
  SuperAdmin = 0,
  BrandAdmin = 1,
  HotelManager = 2,
  Receptionist = 3,
  Guest = 4
}

enum UserStatus {
  Active = 0,
  Inactive = 1,
  Suspended = 2,
  PendingVerification = 3
}

// Brand Types
interface BrandDto {
  id: string;
  name: string;
  description?: string;
  logoUrl?: string;
  website?: string;
  email?: string;
  phoneNumber?: string;
  address?: string;
  city?: string;
  country?: string;
  postalCode?: string;
  taxId?: string;
  businessLicense?: string;
  commissionRate?: string;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

interface CreateBrandDto {
  name: string;
  description?: string;
  logoUrl?: string;
  website?: string;
  email?: string;
  phoneNumber?: string;
  address?: string;
  city?: string;
  country?: string;
}

interface UpdateBrandDto {
  name?: string;
  description?: string;
  logoUrl?: string;
  website?: string;
  email?: string;
  phoneNumber?: string;
  address?: string;
  city?: string;
  country?: string;
  isActive?: boolean;
}

// Dashboard Types (Aggregate for Admin)
interface DashboardSummaryDto {
  revenue: RevenueStatsDto;
  bookings: BookingStatsDto;
  occupancy: OccupancyStatsDto;
  reviews: ReviewStatsDto;
  topRooms: TopRoomDto[];
  recentActivities: RecentActivityDto[];
}

interface RevenueStatsDto {
  todayRevenue: number;
  weekRevenue: number;
  monthRevenue: number;
  yearRevenue: number;
  revenueGrowth: number;
  currency: string;
}

interface BookingStatsDto {
  totalBookings: number;
  pendingBookings: number;
  confirmedBookings: number;
  checkedInBookings: number;
  cancelledBookings: number;
  todayCheckIns: number;
  todayCheckOuts: number;
  bookingGrowth: number;
}

interface OccupancyStatsDto {
  totalRooms: number;
  occupiedRooms: number;
  availableRooms: number;
  maintenanceRooms: number;
  occupancyRate: number;
  averageDailyRate: number;
  revPAR: number;
}

interface ReviewStatsDto {
  totalReviews: number;
  pendingReviews: number;
  averageRating: number;
  fiveStarCount: number;
  fourStarCount: number;
  threeStarCount: number;
  twoStarCount: number;
  oneStarCount: number;
}

// ============ PERMISSION TYPES ============

interface UserPermissions {
  permissions: string[];
  scope: 'system' | 'brand' | 'hotel';
  brandId?: string;
  hotelId?: string;
}

interface PermissionCheckResult {
  hasPermission: boolean;
  permission: string;
  scope: string;
}

interface RolePermission {
  role: UserRole;
  permissions: string[];
}

const PERMISSION_POLICIES = {
  // Brand permissions
  BRANDS_READ: 'Permission:brands.read',
  BRANDS_CREATE: 'Permission:brands.create',
  BRANDS_UPDATE: 'Permission:brands.update',
  BRANDS_DELETE: 'Permission:brands.delete',

  // User permissions
  USERS_READ: 'Permission:users.read',
  USERS_CREATE: 'Permission:users.create',
  USERS_UPDATE: 'Permission:users.update',
  USERS_DELETE: 'Permission:users.delete',

  // Dashboard permissions
  DASHBOARD_VIEW: 'Permission:dashboard.view',
  DASHBOARD_VIEW_ALL: 'Permission:dashboard.viewall',

  // Subscription permissions
  SUBSCRIPTIONS_READ: 'Permission:subscriptions.read',
  SUBSCRIPTIONS_UPDATE: 'Permission:subscriptions.update',
} as const;

// Default permissions by role
const ROLE_DEFAULT_PERMISSIONS: Record<UserRole, string[]> = {
  [UserRole.SuperAdmin]: [
    PERMISSION_POLICIES.BRANDS_READ,
    PERMISSION_POLICIES.BRANDS_CREATE,
    PERMISSION_POLICIES.BRANDS_UPDATE,
    PERMISSION_POLICIES.BRANDS_DELETE,
    PERMISSION_POLICIES.USERS_READ,
    PERMISSION_POLICIES.USERS_CREATE,
    PERMISSION_POLICIES.USERS_UPDATE,
    PERMISSION_POLICIES.USERS_DELETE,
    PERMISSION_POLICIES.DASHBOARD_VIEW_ALL,
    PERMISSION_POLICIES.SUBSCRIPTIONS_READ,
    PERMISSION_POLICIES.SUBSCRIPTIONS_UPDATE,
  ],
  [UserRole.BrandAdmin]: [
    PERMISSION_POLICIES.BRANDS_READ,
    PERMISSION_POLICIES.USERS_READ,
    PERMISSION_POLICIES.USERS_CREATE,
    PERMISSION_POLICIES.USERS_UPDATE,
    PERMISSION_POLICIES.USERS_DELETE,
    PERMISSION_POLICIES.DASHBOARD_VIEW,
    PERMISSION_POLICIES.SUBSCRIPTIONS_READ,
  ],
  [UserRole.HotelManager]: [
    PERMISSION_POLICIES.USERS_READ,
    PERMISSION_POLICIES.USERS_CREATE,
    PERMISSION_POLICIES.USERS_UPDATE,
    PERMISSION_POLICIES.DASHBOARD_VIEW,
  ],
  [UserRole.Receptionist]: [],
  [UserRole.Guest]: [],
} as const;
