# Module 02: Hotel Search & Discovery

## Screens

| Screen | Route | Mô t? |
|--------|-------|-------|
| Home | `/` | Landing page v?i search |
| Search Results | `/search` | Danh sách hotels v?i filters |
| Hotel Detail | `/hotels/[id]` | Chi ti?t hotel |
| Room Detail | `/hotels/[id]/rooms/[roomId]` | Chi ti?t phòng |

---

## API Endpoints

### 1. Search Hotels
```http
GET /api/hotels/search
```

**Query Parameters:**
| Param | Type | Default | Mô t? |
|-------|------|---------|-------|
| `city` | string | - | Tìm theo thành ph? |
| `country` | string | - | Tìm theo qu?c gia |
| `checkIn` | date | - | Ngày check-in (ISO 8601) |
| `checkOut` | date | - | Ngày check-out |
| `guests` | int | 1 | S? khách |
| `rooms` | int | 1 | S? phòng |
| `minPrice` | decimal | - | Giá t?i thi?u |
| `maxPrice` | decimal | - | Giá t?i ?a |
| `starRating` | int | - | S? sao (1-5) |
| `amenities` | string | - | Comma-separated amenity IDs |
| `sortBy` | string | rating | `rating`, `price`, `distance` |
| `sortDesc` | bool | true | S?p x?p gi?m d?n |
| `page` | int | 1 | Trang |
| `pageSize` | int | 10 | S? items/trang |

**Example:**
```
GET /api/hotels/search?city=Hanoi&checkIn=2024-02-01&checkOut=2024-02-03&guests=2&minPrice=500000&maxPrice=5000000&starRating=4&sortBy=rating
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "uuid",
        "name": "Marriott Hanoi",
        "description": "Khách s?n sang tr?ng trung tâm Hà N?i",
        "imageUrl": "https://...",
        "address": "123 ???ng Lý Th??ng Ki?t",
        "city": "Hà N?i",
        "country": "Vi?t Nam",
        "starRating": 5,
        "averageRating": 4.5,
        "reviewCount": 234,
        "startingPrice": 2500000,
        "currency": "VND",
        "amenities": ["wifi", "pool", "gym"],
        "distanceFromCenter": 2.5
      }
    ],
    "totalCount": 45,
    "page": 1,
    "pageSize": 10,
    "totalPages": 5,
    "facets": {
      "starRatings": [
        { "value": "5", "count": 12 },
        { "value": "4", "count": 20 }
      ],
      "priceRanges": [
        { "value": "0-2000000", "count": 15 },
        { "value": "2000000-5000000", "count": 25 }
      ],
      "amenities": [
        { "value": "wifi", "label": "Free WiFi", "count": 40 },
        { "value": "pool", "label": "H? b?i", "count": 18 }
      ]
    }
  }
}
```

---

### 2. AI Search (Semantic)
```http
POST /api/hotels/ai-search
```

**Request:**
```json
{
  "query": "khách s?n lãng m?n ven bi?n có spa cho tu?n tr?ng m?t",
  "checkIn": "2024-02-14",
  "checkOut": "2024-02-17",
  "guests": 2,
  "maxResults": 10
}
```

**Response:** Same as regular search

---

### 3. Get Hotel Detail
```http
GET /api/hotels/{id}
```

**Response (200):**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "name": "Marriott Hanoi",
    "description": "Mô t? chi ti?t...",
    "imageUrl": "https://...",
    "coverImageUrl": "https://...",
    "images": [
      { "url": "https://...", "caption": "S?nh", "category": "lobby" },
      { "url": "https://...", "caption": "H? b?i", "category": "facilities" }
    ],
    "address": "123 ???ng Lý Th??ng Ki?t",
    "city": "Hà N?i",
    "state": null,
    "country": "Vi?t Nam",
    "postalCode": "100000",
    "latitude": 21.0285,
    "longitude": 105.8542,
    "phoneNumber": "+84-24-1234-5678",
    "email": "info@marriott-hanoi.com",
    "website": "https://marriott.com/hanoi",
    "starRating": 5,
    "averageRating": 4.5,
    "reviewCount": 234,
    "checkInTime": "14:00",
    "checkOutTime": "12:00",
    "cancellationPolicy": "Mi?n phí h?y tr??c 48 gi? check-in",
    "childPolicy": "Tr? em d??i 12 tu?i mi?n phí",
    "petPolicy": "Cho phép thú c?ng v?i ph? thu 500,000 VND",
    "amenities": [
      { "id": "uuid", "name": "Free WiFi", "icon": "wifi", "type": "General" },
      { "id": "uuid", "name": "H? b?i", "icon": "pool", "type": "Facilities" }
    ],
    "brand": {
      "id": "uuid",
      "name": "Marriott Hotels",
      "logoUrl": "https://..."
    }
  }
}
```

---

### 4. Get Hotel Rooms
```http
GET /api/hotels/{hotelId}/rooms
```

**Query Parameters:**
| Param | Type | Mô t? |
|-------|------|-------|
| `checkIn` | date | Ngày check-in |
| `checkOut` | date | Ngày check-out |
| `guests` | int | S? khách |

**Response (200):**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "roomNumber": "301",
      "type": "Deluxe",
      "bedType": "King",
      "numberOfBeds": 1,
      "maxOccupancy": 2,
      "sizeInSquareMeters": 35,
      "description": "Phòng r?ng rãi v?i t?m nhìn thành ph?",
      "basePrice": 2500000,
      "weekendPrice": 3000000,
      "currentPrice": 2500000,
      "currency": "VND",
      "hasView": true,
      "viewDescription": "T?m nhìn thành ph?",
      "isPetFriendly": false,
      "isAccessible": true,
      "status": "Available",
      "images": [
        { "url": "https://...", "isPrimary": true }
      ],
      "amenities": [
        { "name": "?i?u hòa", "icon": "snowflake" },
        { "name": "Smart TV", "icon": "tv" }
      ]
    }
  ]
}
```

---

### 5. Get Room Availability
```http
GET /api/hotels/{hotelId}/rooms/{roomId}/availability
```

**Query Parameters:**
| Param | Type | Mô t? |
|-------|------|-------|
| `checkIn` | date | Ngày b?t ??u |
| `checkOut` | date | Ngày k?t thúc |

**Response:**
```json
{
  "success": true,
  "data": {
    "isAvailable": true,
    "totalPrice": 7500000,
    "priceBreakdown": [
      { "date": "2024-02-01", "price": 2500000 },
      { "date": "2024-02-02", "price": 2500000 },
      { "date": "2024-02-03", "price": 2500000 }
    ]
  }
}
```

---

### 6. Get Hotel Reviews
```http
GET /api/hotels/{hotelId}/reviews
```

**Query Parameters:**
| Param | Type | Default | Mô t? |
|-------|------|---------|-------|
| `rating` | int | - | Filter by rating |
| `sortBy` | string | date | `date`, `rating`, `helpful` |
| `page` | int | 1 | |
| `pageSize` | int | 10 | |

**Response:**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "uuid",
        "rating": 5,
        "title": "K? ngh? tuy?t v?i!",
        "comment": "Phòng r?t s?ch s?...",
        "cleanlinessRating": 5,
        "serviceRating": 5,
        "locationRating": 5,
        "valueRating": 4,
        "stayDate": "2024-01-10",
        "isVerified": true,
        "helpfulCount": 12,
        "guest": {
          "firstName": "Minh",
          "avatarUrl": "https://..."
        },
        "managementResponse": "C?m ?n b?n ?ã ?ánh giá!",
        "images": ["https://..."],
        "createdAt": "2024-01-15T10:00:00Z"
      }
    ],
    "summary": {
      "averageRating": 4.5,
      "totalReviews": 234,
      "ratingBreakdown": {
        "5": 150,
        "4": 50,
        "3": 20,
        "2": 10,
        "1": 4
      },
      "categoryAverages": {
        "cleanliness": 4.7,
        "service": 4.5,
        "location": 4.8,
        "value": 4.2
      }
    }
  }
}
```

---

### 7. Get All Amenities (for filters)
```http
GET /api/amenities
```

**Response:**
```json
{
  "success": true,
  "data": [
    { "id": "uuid", "name": "Free WiFi", "icon": "wifi", "type": "General" },
    { "id": "uuid", "name": "H? b?i", "icon": "pool", "type": "Facilities" }
  ]
}
```

---

## Screen Specifications

### Home / Search Screen
```
????????????????????????????????????????????????????
?  ?? Tìm ch? ngh? hoàn h?o                        ?
?                                                  ?
?  ????????????????????????????????????????????   ?
?  ? ?? B?n mu?n ?i ?âu?                      ?   ?
?  ?    Hà N?i                                 ?   ?
?  ????????????????????????????????????????????   ?
?  ? ?? Nh?n phòng     ? ?? Tr? phòng         ?   ?
?  ?    01/02/2024     ?    03/02/2024        ?   ?
?  ????????????????????????????????????????????   ?
?  ? ?? 2 Ng??i l?n, 1 Phòng                  ?   ?
?  ????????????????????????????????????????????   ?
?                                                  ?
?  ????????????????????????????????????????????   ?
?  ?              ?? Tìm ki?m                 ?   ?
?  ????????????????????????????????????????????   ?
?                                                  ?
?  ??? ?i?m ??n ph? bi?n ???????????????????????  ?
?  ?????? ?????? ?????? ??????                   ?
?  ?    ? ?    ? ?    ? ?    ?                   ?
?  ? HN ? ? SG ? ? DN ? ? NTR?                   ?
?  ?????? ?????? ?????? ??????                   ?
????????????????????????????????????????????????????
```

### Search Results Screen
```
????????????????????????????????????????????????????
?  ? Quay l?i    Hà N?i              ?? B? l?c    ?
????????????????????????????????????????????????????
?  45 khách s?n | 01-03/02 | 2 khách               ?
????????????????????????????????????????????????????
?  [S?p x?p: Rating ?] [Giá] [Kho?ng cách]         ?
????????????????????????????????????????????????????
?  ?????????????????????????????????????????????? ?
?  ? ???     ? Marriott Hanoi             ?5   ? ?
?  ?        ? ????? 4.5 (234 ?ánh giá)         ? ?
?  ?        ? Hoàn Ki?m • 2.5km t? trung tâm   ? ?
?  ?        ? ?? ??? ?? ???                      ? ?
?  ?        ?              T? 2,500,000 VND/?êm? ?
?  ?????????????????????????????????????????????? ?
?  ?????????????????????????????????????????????? ?
?  ? ???     ? Hilton Opera              ?4   ? ?
?  ?        ? ????? 4.2 (180 ?ánh giá)         ? ?
?  ?        ? Ba ?ình • 3.0km t? trung tâm     ? ?
?  ?        ? ?? ??                             ? ?
?  ?        ?              T? 1,800,000 VND/?êm? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  [Xem thêm...]                                   ?
????????????????????????????????????????????????????
```

### Filter Modal
```
????????????????????????????????????????
?  B? l?c                    ??t l?i   ?
????????????????????????????????????????
?  Kho?ng giá                          ?
?  0 ?????????????? 10,000,000 VND     ?
?      500,000   5,000,000             ?
????????????????????????????????????????
?  H?ng sao                            ?
?  ? ?????  ? ????  ? ???     ?
????????????????????????????????????????
?  Ti?n nghi                           ?
?  ? Free WiFi     ? H? b?i           ?
?  ? Gym           ? Spa              ?
?  ? Nhà hàng      ? Bãi ?? xe        ?
????????????????????????????????????????
?  ?ánh giá                            ?
?  ? 9+ Xu?t s?c                       ?
?  ? 8+ R?t t?t                        ?
?  ? 7+ T?t                            ?
????????????????????????????????????????
?  ??????????????????????????????????  ?
?  ?      Áp d?ng b? l?c (23)       ?  ?
?  ??????????????????????????????????  ?
????????????????????????????????????????
```

### Hotel Detail Screen
```
????????????????????????????????????????????????????
?  ? Quay l?i    Marriott Hanoi      ?? ??        ?
????????????????????????????????????????????????????
?  ????????????????????????????????????????????   ?
?  ?                                          ?   ?
?  ?          [Cover Image Gallery]           ?   ?
?  ?              • • ? ? ?                   ?   ?
?  ????????????????????????????????????????????   ?
?                                                  ?
?  Marriott Hanoi                     ?????   ?
?  ?? 123 Lý Th??ng Ki?t, Hoàn Ki?m, Hà N?i       ?
?  ? 4.5 (234 ?ánh giá) • Xu?t s?c                ?
?                                                  ?
?  ??? Ti?n nghi ????????????????????????????????  ?
?  ?? H? b?i ??? Gym ?? WiFi ??? ?? xe ?? ?n sáng ?
?                                                  ?
?  ??? Mô t? ????????????????????????????????????  ?
?  Khách s?n sang tr?ng t?i trung tâm Hà N?i...   ?
?  [Xem thêm]                                      ?
?                                                  ?
?  ??? Ch?n phòng ???????????????????????????????  ?
?  ?????????????????????????????????????????????? ?
?  ? ??? ? Deluxe King Room                     ? ?
?  ?    ? ?? 2 khách • ??? 1 King • 35m²        ? ?
?  ?    ? ?? ??? ?? ?                            ? ?
?  ?    ? ? Mi?n phí h?y                       ? ?
?  ?    ?                      2,500,000 VND/?êm? ?
?  ?    ?                         [Ch?n phòng] ? ?
?  ?????????????????????????????????????????????? ?
?                                                  ?
?  ??? ?ánh giá ?????????????????????????????????  ?
?  [Review Summary + Top Reviews]                  ?
?                                                  ?
?  ??? V? trí ???????????????????????????????????  ?
?  [Google Maps Embed]                             ?
?                                                  ?
?  ??? Chính sách ???????????????????????????????  ?
?  Nh?n phòng: 14:00 | Tr? phòng: 12:00            ?
?  H?y phòng: Mi?n phí tr??c 48 gi?                ?
????????????????????????????????????????????????????
```

---

## Related APIs for Logged-in Users

### Add to Wishlist
```http
POST /api/wishlist
Authorization: Bearer {token}

{ "hotelId": "uuid" }
```

### Track Recently Viewed
```http
POST /api/guest-profile/recently-viewed/{hotelId}
Authorization: Bearer {token}

```

---

## TypeScript Types

```typescript
// Search
interface HotelSearchParams {
  city?: string;
  country?: string;
  checkIn?: string;
  checkOut?: string;
  guests?: number;
  rooms?: number;
  minPrice?: number;
  maxPrice?: number;
  starRating?: number;
  amenities?: string[];
  sortBy?: 'rating' | 'price' | 'distance';
  sortDesc?: boolean;
  page?: number;
  pageSize?: number;
}

interface HotelSearchResult {
  items: HotelListItemDto[];
  totalCount: number;
  page: number;
  pageSize: number;
  totalPages: number;
  facets: SearchFacets;
}

interface HotelListItemDto {
  id: string;
  name: string;
  description: string;
  imageUrl: string;
  address: string;
  city: string;
  country: string;
  starRating: number;
  averageRating: number;
  reviewCount: number;
  startingPrice: number;
  currency: string;
  amenities: string[];
  distanceFromCenter?: number;
}

// Hotel Detail
interface HotelDetailDto {
  id: string;
  name: string;
  description: string;
  imageUrl: string;
  coverImageUrl: string;
  images: HotelImageDto[];
  address: string;
  city: string;
  state?: string;
  country: string;
  postalCode?: string;
  latitude?: number;
  longitude?: number;
  phoneNumber?: string;
  email?: string;
  website?: string;
  starRating: number;
  averageRating: number;
  reviewCount: number;
  checkInTime: string;
  checkOutTime: string;
  cancellationPolicy?: string;
  childPolicy?: string;
  petPolicy?: string;
  amenities: AmenityDto[];
  brand: BrandSummaryDto;
}

// Room
interface RoomDto {
  id: string;
  roomNumber: string;
  type: RoomType;
  bedType: BedType;
  numberOfBeds: number;
  maxOccupancy: number;
  sizeInSquareMeters: number;
  description?: string;
  basePrice: number;
  currentPrice: number;
  currency: string;
  hasView: boolean;
  viewDescription?: string;
  isPetFriendly: boolean;
  isAccessible: boolean;
  status: RoomStatus;
  images: RoomImageDto[];
  amenities: AmenityDto[];
}

enum RoomType {
  Standard = 0,
  Deluxe = 1,
  Suite = 2,
  Executive = 3,
  Presidential = 4
}

enum BedType {
  Single = 0,
  Double = 1,
  Queen = 2,
  King = 3,
  Twin = 4
}

enum RoomStatus {
    Available = 0,
    Occupied = 1,
    Maintenance = 2,
    Cleaning = 3,
    OutOfOrder = 4,
    Reserved = 5
}
